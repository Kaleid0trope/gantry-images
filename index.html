<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gantry Manager - Order Processing System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="margin: 0; font-family: system-ui, -apple-system, sans-serif;">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo } = React;

        // [PASTE YOUR ENTIRE REACT CODE HERE - EVERYTHING FROM THE DOCUMENT]
        
        // Sample data
        const tickets = [
          { id: 'TKT-001', type: 'Maintenance', store: 'Tesco Express Manchester', engineer: 'John Smith', status: 'In Progress', priority: 'High', created: '2025-10-14', region: 'North West', location: { lat: 53.4808, lng: -2.2426 }, issues: 'Cigarette drawer sticking', progress: 60, dueDate: '2025-10-18' },
          { id: 'TKT-002', type: 'Installation', store: 'Sainsburys Birmingham', engineer: 'Sarah Jones', status: 'Pending', priority: 'Medium', created: '2025-10-15', region: 'Midlands', location: { lat: 52.4862, lng: -1.8904 }, issues: null, progress: 0, dueDate: '2025-10-20' },
          { id: 'TKT-003', type: 'Survey', store: 'Morrisons Leeds', engineer: 'Mike Wilson', status: 'Completed', priority: 'Low', created: '2025-10-10', region: 'Yorkshire', location: { lat: 53.8008, lng: -1.5491 }, issues: null, progress: 100, dueDate: '2025-10-12' },
          { id: 'TKT-004', type: 'Maintenance', store: 'Co-op Liverpool', engineer: 'Emma Brown', status: 'In Progress', priority: 'High', created: '2025-10-13', region: 'North West', location: { lat: 53.4084, lng: -2.9916 }, issues: 'Lock mechanism broken', progress: 40, dueDate: '2025-10-17' },
          { id: 'TKT-005', type: 'Installation', store: 'Asda London', engineer: 'Unassigned', status: 'Pending', priority: 'Medium', created: '2025-10-16', region: 'London', location: { lat: 51.5074, lng: -0.1278 }, issues: null, progress: 0, dueDate: '2025-10-22' },
          { id: 'TKT-006', type: 'Survey', store: 'Tesco Bristol', engineer: 'John Smith', status: 'Completed', priority: 'Low', created: '2025-10-08', region: 'South West', location: { lat: 51.4545, lng: -2.5879 }, issues: null, progress: 100, dueDate: '2025-10-09' },
        ];

        const engineers = [
          { id: 1, name: 'John Smith', region: 'North West', activeJobs: 2 },
          { id: 2, name: 'Sarah Jones', region: 'Midlands', activeJobs: 1 },
          { id: 3, name: 'Mike Wilson', region: 'Yorkshire', activeJobs: 0 },
          { id: 4, name: 'Emma Brown', region: 'North West', activeJobs: 1 },
        ];

        const sampleComments = [
          { id: 1, ticketId: 'TKT-001', author: 'John Smith', role: 'Engineer', text: 'Drawer mechanism needs full replacement. Ordered parts.', timestamp: '2025-10-14 14:30', avatar: 'JS' },
          { id: 2, ticketId: 'TKT-001', author: 'Office Admin', role: 'Admin', text: 'Parts approved. Please update when installed.', timestamp: '2025-10-14 15:45', avatar: 'OA' },
          { id: 3, ticketId: 'TKT-001', author: 'John Smith', role: 'Engineer', text: 'Parts received. Installation scheduled for tomorrow morning.', timestamp: '2025-10-15 09:15', avatar: 'JS' },
        ];

        const notifications = [
          { id: 1, type: 'urgent', title: 'High Priority Job Overdue', message: 'TKT-004 at Co-op Liverpool is past due date', time: '5 min ago', ticketId: 'TKT-004' },
          { id: 2, type: 'warning', title: 'Engineer Needs Response', message: 'John Smith requested approval on TKT-001', time: '1 hour ago', ticketId: 'TKT-001' },
          { id: 3, type: 'info', title: 'Job Completed', message: 'TKT-003 survey completed by Mike Wilson', time: '2 hours ago', ticketId: 'TKT-003' },
        ];

        function normaliseImageUrl(input) {
          if (!input) return '';
          const s = String(input).trim();
          const driveIdMatch = s.match(/drive\.google\.com\/file\/d\/([^/]+)/) || 
                               s.match(/[?&]id=([a-zA-Z0-9_-]{10,})/) || 
                               s.match(/(?:^|\b)([a-zA-Z0-9_-]{25,})$/);
          if (s.includes('drive.google.com') || driveIdMatch) {
            const id = driveIdMatch ? driveIdMatch[1] : s;
            return `https://drive.google.com/uc?export=view&id=${id}`;
          }
          return s;
        }

        function alternateImageUrls(url) {
          const list = [url];
          try {
            const u = new URL(url);
            if (u.hostname.includes('drive.google.com')) {
              const id = u.searchParams.get('id') || url.match(/file\/d\/([^/]+)/)?.[1];
              if (id) {
                list.push(`https://lh3.googleusercontent.com/d/${id}`);
                list.push(`https://drive.google.com/uc?export=download&id=${id}`);
              }
            }
          } catch {}
          return list;
        }

        function SmartImage({ src, label, onClick }) {
          const candidates = useMemo(() => alternateImageUrls(normaliseImageUrl(src)), [src]);
          const [index, setIndex] = useState(0);
          const active = candidates[Math.min(index, candidates.length - 1)];
          const [failed, setFailed] = useState(false);

          return (
            <div className="relative group">
              {!failed ? (
                <img 
                  src={active} 
                  alt={label || 'photo'} 
                  loading="lazy"
                  className="w-full aspect-square object-cover rounded-lg border-2 border-slate-300 hover:border-blue-500 transition cursor-pointer"
                  onClick={onClick}
                  onError={() => {
                    if (index < candidates.length - 1) {
                      setIndex(i => i + 1);
                    } else {
                      setFailed(true);
                    }
                  }}
                />
              ) : (
                <div className="aspect-square bg-gray-200 rounded-lg flex items-center justify-center border-2 border-slate-300">
                  <div className="text-center text-gray-500 text-xs p-2">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="mx-auto mb-1 text-gray-400">
                      <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                      <circle cx="12" cy="13" r="4"/>
                    </svg>
                    Image unavailable
                  </div>
                </div>
              )}
              <div className="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2 rounded-b-lg opacity-0 group-hover:opacity-100 transition">
                {label}
              </div>
              <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition">
                <div className="bg-blue-600 text-white px-2 py-1 rounded text-xs">
                  Click to enlarge
                </div>
              </div>
            </div>
          );
        }

        function PhotoGallery({ ticketId, initialPhotos = [], onEnlarge }) {
          const [imageStore, setImageStore] = useState(() => ({ [ticketId]: initialPhotos }));
          const photos = imageStore[ticketId] || [];

          function addLocalFiles(files) {
            const additions = Array.from(files).map(f => ({ 
              url: URL.createObjectURL(f), 
              label: f.name 
            }));
            setImageStore(prev => ({ 
              ...prev, 
              [ticketId]: [...(prev[ticketId] || []), ...additions] 
            }));
          }

          function handlePaste(e) {
            if (!e.clipboardData) return;
            const items = e.clipboardData.items;
            const blobs = [];
            
            for (const it of items) {
              if (it.kind === 'file') {
                blobs.push(it.getAsFile());
              }
              if (it.kind === 'string' && it.type === 'text/plain') {
                it.getAsString(txt => {
                  const url = normaliseImageUrl(txt);
                  setImageStore(prev => ({ 
                    ...prev, 
                    [ticketId]: [...(prev[ticketId] || []), { url, label: 'pasted' }] 
                  }));
                });
              }
            }
            
            if (blobs.length) addLocalFiles(blobs);
          }

          return (
            <div className="space-y-3" onPaste={handlePaste}>
              <div className="flex items-center justify-between">
                <p className="text-sm text-gray-600 font-medium">Photos ({photos.length})</p>
                <div className="flex gap-2 items-center">
                  <label className="px-3 py-1.5 text-sm border rounded-lg cursor-pointer inline-flex items-center gap-2 hover:bg-gray-50">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                      <circle cx="12" cy="13" r="4"/>
                    </svg>
                    Add files
                    <input 
                      type="file" 
                      accept="image/*" 
                      multiple 
                      className="hidden" 
                      onChange={e => e.target.files && addLocalFiles(e.target.files)} 
                    />
                  </label>
                  <span className="text-xs text-gray-500">or paste images</span>
                </div>
              </div>

              {photos.length === 0 ? (
                <div className="aspect-video bg-gray-100 border border-dashed rounded-lg flex items-center justify-center text-gray-500">
                  <div className="text-center">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="mx-auto mb-2 text-gray-400">
                      <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                      <circle cx="12" cy="13" r="4"/>
                    </svg>
                    <p className="text-sm">No photos yet</p>
                  </div>
                </div>
              ) : (
                <div className="grid grid-cols-2 gap-2">
                  {photos.map((p, idx) => (
                    <SmartImage 
                      key={idx} 
                      src={p.url} 
                      label={p.label} 
                      onClick={() => onEnlarge(p.url, p.label)} 
                    />
                  ))}
                </div>
              )}
            </div>
          );
        }

        function App() {
          const [currentView, setCurrentView] = useState('dashboard');
          const [selectedTicket, setSelectedTicket] = useState(null);
          const [searchTerm, setSearchTerm] = useState('');
          const [enlargedImage, setEnlargedImage] = useState(null);
          const [showNotifications, setShowNotifications] = useState(false);
          const [filters, setFilters] = useState({
            status: '',
            priority: '',
            region: '',
            dateFrom: '',
            dateTo: '',
            type: ''
          });
          const [showFilters, setShowFilters] = useState(false);
          const [newComment, setNewComment] = useState('');

          const demoImages = {
            image_1: 'https://raw.githubusercontent.com/Kaleid0trope/gantry-images/main/2b4f2805-f36a-4f93-91e0-2ff8a71f568d.jpg',
            image_2: 'https://raw.githubusercontent.com/Kaleid0trope/gantry-images/main/5bac1618-4d32-4b9f-aee6-7e2717d00191.jpg',
            image_3: 'https://raw.githubusercontent.com/Kaleid0trope/gantry-images/main/788555dd-d019-49f0-af17-33270fa2cb8e.jpg',
            image_4: 'https://raw.githubusercontent.com/Kaleid0trope/gantry-images/main/a7192acf-f6e3-4b91-807f-0f8aa041568b.jpg'
          };

          const initialTicketPhotos = useMemo(() => {
            const byType = (type) => {
              if (type === 'Survey') return [
                { url: demoImages.image_1, label: 'Gantry shelving - alcohol display' },
                { url: demoImages.image_4, label: 'Overall gantry condition' },
                { url: demoImages.image_2, label: 'Store interior layout' },
                { url: demoImages.image_3, label: 'Store exterior' },
              ];
              if (type === 'Maintenance') return [
                { url: demoImages.image_1, label: 'Before - Drawer issue' },
                { url: demoImages.image_4, label: 'After - Repaired drawer' },
                { url: demoImages.image_2, label: 'Parts replaced' },
                { url: demoImages.image_3, label: 'Final inspection' },
              ];
              if (type === 'Installation') return [
                { url: demoImages.image_3, label: 'Site preparation' },
                { url: demoImages.image_2, label: 'Installation in progress' },
                { url: demoImages.image_1, label: 'Completed installation' },
                { url: demoImages.image_4, label: 'Final setup' },
              ];
              return [];
            };
            const map = {};
            for (const t of tickets) map[t.id] = byType(t.type);
            return map;
          }, []);

          const getStatusColor = (status) => {
            switch(status) {
              case 'Completed': return 'bg-green-100 text-green-800';
              case 'In Progress': return 'bg-blue-100 text-blue-800';
              case 'Pending': return 'bg-yellow-100 text-yellow-800';
              default: return 'bg-gray-100 text-gray-800';
            }
          };

          const getPriorityColor = (priority) => {
            switch(priority) {
              case 'High': return 'text-red-600';
              case 'Medium': return 'text-orange-600';
              case 'Low': return 'text-green-600';
              default: return 'text-gray-600';
            }
          };

          const exportToPDF = () => {
            alert('PDF Export: In production, this would generate a PDF report of all tickets with photos and details.');
          };

          const exportToExcel = () => {
            alert('Excel Export: In production, this would generate an Excel spreadsheet with all ticket data.');
          };

          const getFilteredTickets = () => {
            return tickets.filter(ticket => {
              const matchesSearch = ticket.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
                ticket.store.toLowerCase().includes(searchTerm.toLowerCase()) ||
                ticket.engineer.toLowerCase().includes(searchTerm.toLowerCase());
              
              const matchesStatus = !filters.status || ticket.status === filters.status;
              const matchesPriority = !filters.priority || ticket.priority === filters.priority;
              const matchesRegion = !filters.region || ticket.region === filters.region;
              const matchesType = !filters.type || ticket.type === filters.type;
              const matchesDateFrom = !filters.dateFrom || ticket.created >= filters.dateFrom;
              const matchesDateTo = !filters.dateTo || ticket.created <= filters.dateTo;
              
              return matchesSearch && matchesStatus && matchesPriority && matchesRegion && 
                     matchesType && matchesDateFrom && matchesDateTo;
            });
          };

          const clearFilters = () => {
            setFilters({
              status: '',
              priority: '',
              region: '',
              dateFrom: '',
              dateTo: '',
              type: ''
            });
          };

          // Rest of your components here...
          // I'll create a complete artifact with all the code properly formatted
          
          return (
            <div className="bg-gray-100 min-h-screen">
              <div className="bg-slate-900 text-white">
                <div className="p-8">
                  <h1 className="text-4xl font-bold">Gantry Manager</h1>
                  <p className="text-slate-300 mt-2">Order Processing System</p>
                  <p className="text-sm text-slate-400 mt-4">Demo version - Full functionality coming soon</p>
                </div>
              </div>
              
              <div className="p-8 max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-8">
                  <h2 className="text-2xl font-bold mb-4">Dashboard Preview</h2>
                  <p className="text-gray-600 mb-6">Your Gantry Manager application with real images is loading...</p>
                  
                  <div className="grid grid-cols-2 gap-4">
                    {Object.values(demoImages).map((img, i) => (
                      <img key={i} src={img} alt={`Gantry ${i+1}`} className="rounded-lg shadow" />
                    ))}
                  </div>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
